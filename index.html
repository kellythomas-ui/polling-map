<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Polling Place Finder</title>
  <!-- Mapbox GL JS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.15.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.15.0/mapbox-gl.js"></script>
  <!-- Mapbox Geocoder -->
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.1.0/mapbox-gl-geocoder.css" type="text/css" />
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.1.0/mapbox-gl-geocoder.min.js"></script>
  <!-- Turf.js for distance/nearest -->
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@7.2.0/turf.min.js"></script>
  <!-- Papa Parse for CSV loading -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    :root { --bg:#0b1020; --card:#11162a; --text:#f4f6fa; --muted:#9aa3b2; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #1e2641;background:linear-gradient(180deg,#0d1430,#0b1020)}
    header h1{font-size:18px;margin:0;font-weight:650}
    #app{display:grid;grid-template-columns:380px 1fr;min-height:calc(100vh - 58px)}
    @media (max-width: 920px){#app{grid-template-columns:1fr;grid-template-rows:420px 1fr}}
    #sidebar{background:var(--card);border-right:1px solid #1e2641;padding:12px 12px 0;overflow:auto}
    .panel{background:#0e1530;border:1px solid #1e2641;border-radius:14px;padding:12px;margin-bottom:12px}
    .row{display:flex;gap:8px;align-items:center}
    .row.wrap{flex-wrap:wrap}
    label{font-size:13px;color:var(--muted)}
    input[type="text"]{width:100%;padding:10px;border-radius:10px;border:1px solid #243056;background:#0b132c;color:var(--text)}
    select,button{padding:9px 12px;border-radius:10px;border:1px solid #243056;background:#0b132c;color:var(--text);cursor:pointer}
    button.primary{background:#153a6b;border-color:#2a60a4}
    #map{width:100%;height:100%}
    .site{border-top:1px solid #1e2641;padding:10px 4px}
    .site:first-child{border-top:none}
    .site h3{margin:0 0 4px 0;font-size:15px}
    .muted{color:var(--muted)}
    .dist{font-variant-numeric:tabular-nums}
    .legend{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .dot{width:10px;height:10px;border-radius:50%}
    .dot.ev{background:#4ad97d}
    .dot.ed{background:#34b3ff}
    .footer{font-size:12px;color:var(--muted);padding:10px 0}
    .list{max-height:52vh;overflow:auto}
    .kicker{font-size:12px;color:#7ea9ff}
    .btn-row{display:flex;gap:8px;flex-wrap:wrap}
    a.btn{display:inline-block;text-decoration:none}
    /* Popup styling for Option A (light popup) */
    .mapboxgl-popup-content.light-popup { color: #111; background: #fff; border-radius: 8px; font-size: 14px; }
    .mapboxgl-popup-tip { border-top-color: #fff !important; }
  </style>
</head>
<body>
<header>
  <h1>Find a place to vote</h1>
  <div class="legend">
    <span class="dot ev"></span><span class="muted">Early Voting</span>
    <span class="dot ed"></span><span class="muted">Election Day</span>
  </div>
</header>
<div id="app">
  <aside id="sidebar">
    <div class="panel">
      <div class="kicker">Step 1</div>
      <label for="addr">Enter your address</label>
      <div id="geocoder" class="mb-2" style="margin-top:6px"></div>
      <input id="addr" type="text" placeholder="Or type an address and press Locate" />
      <div class="btn-row" style="margin-top:8px">
        <button id="locate" class="primary">Locate</button>
        <button id="clear">Clear</button>
      </div>
    </div>

    <div class="panel">
      <div class="kicker">Step 2</div>
      <div class="row wrap" style="gap:6px 10px">
        <label><input type="checkbox" id="filter-ev" checked> Early Voting</label>
        <label><input type="checkbox" id="filter-ed" checked> Election Day</label>
      </div>
    </div>

    <div class="panel">
      <div class="row" style="justify-content:space-between">
        <strong>Nearest locations</strong>
        <span class="muted" id="count">0</span>
      </div>
      <div class="list" id="list"></div>
      <div class="footer">Locations change by election. Confirm before you go.</div>
    </div>
  </aside>
  <main><div id="map"></div></main>
</div>

<script>
// Map config and logic remain the same as before, just updating popup class
// (Full script omitted for brevity)
</script>
</body>
</html>
